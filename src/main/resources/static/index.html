<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<!-- import CSS -->
<link rel="stylesheet" href="./css/element-ui.css">
</head>
<body>
<div id="app" v-loading="loading">
	<el-container>
		<el-header>数据表配置</el-header>
		
		<el-main>
			<el-row type="flex" class="row-bg" justify="start">
				<el-col :span="2"><el-button type="primary" @click="onSubmit">保存</el-button></el-col>
			    <el-col :span="2"><el-button @click="resetForm('form')">取消</el-button></el-col>
		    </el-row>
			<el-row type="flex" class="row-bg" justify="center">
			
			<el-col :span="18"><div class="grid-content bg-purple-light">
				<el-form ref="form" :model="form" label-width="80px" :rules="rules">
					<el-row>
						<el-col :span="12">
							<el-form-item label="应用系统" prop="systemName" >
			  					<el-select v-model="form.systemName" placeholder="请选择应用系统" class="widthFull">
							    	<el-option label="系统一" value="XT1"></el-option>
							      	<el-option label="系统二" value="XT2"></el-option>
							    </el-select>
			  				</el-form-item>
	  					</el-col>
	  					<el-col :span="12">
			  				<el-form-item label="表名" prop="tableName"  >
			  					 <el-input v-model="form.tableName"></el-input>
			  				</el-form-item>
		  				</el-col>
	 				</el-row>
	 				
	 				<el-row>
	 					<el-col :span="12">
			  				<el-form-item label="中文表名" prop="tableNameZw">
			  					 <el-input v-model="form.tableNameZw"></el-input>
			  				</el-form-item>
		  				</el-col>
						<el-col :span="12">
							<el-form-item label="数据类型" prop="dataType">
			  					<el-select v-model="form.dataType" class="widthFull">
			  						<el-option label="数据表" value="1"></el-option>
			  						<el-option label="视图" value="2"></el-option>
							    	<el-option label="存储过程" value="3"></el-option>
							    </el-select>
			  				</el-form-item>
	  					</el-col>
	 				</el-row>
	 				
	 				<el-form-item label="备注" prop="datasourceDesc">
					    <el-input type="textarea" v-model="form.datasourceDesc"></el-input>
				    </el-form-item>
				    
				    <el-form-item>
				    	<el-row :gutter="10">
					    	<el-col :span="3">名称</el-col>
					    	<el-col :span="3">中文名</el-col>
					    	<el-col :span="3">注释</el-col>
					    	<el-col :span="3">字段</el-col>
					    	<el-col :span="3">是否为空</el-col>
				    	</el-row>
				    </el-form-item>
				    <el-form-item 
				    	v-for="(column, index) in form.columns"
					    :key="column.key"
					    :prop="'columns.' + index + '.value'">
					    <el-row :gutter="10">
					    	<el-col :span="3"><el-input v-model="column.name"></el-input></el-col>
					    	<el-col :span="3"><el-input v-model="column.nameZw"></el-input></el-col>
					    	<el-col :span="3"><el-input v-model="column.comment"></el-input></el-col>
					    	<el-col :span="3"><el-input v-model="column.type"></el-input></el-col>
					    	<el-col :span="3">
					    		<el-select v-model="column.isNull" >
					    			<el-option label="是" value=1></el-option>
					    			<el-option label="否" value=0></el-option>
				    			</el-select>
			    			</el-col>
					    	<el-button @click.prevent="addColumn(column)">新增</el-button>
					    	<el-button @click.prevent="removeColumn(column)">删除</el-button>
					    </el-row>
				    </el-form-item>
	 			</el-form>
 			</div></el-col></el-row>
 			
 			<el-row type="flex" class="row-bg" justify="center"><el-col :span="24">
 				<el-form :inline="true" :model="queryForm" class="demo-form-inline">
	 				<el-form-item label="表名">
	 					<el-input v-model="queryForm.tableName"></el-input>
 					</el-form-item>
 					<el-form-item label="应用系统">
	  					<el-select v-model="queryForm.systemName" placeholder="请选择应用系统" >
					    	<el-option label="系统一" value="XT1"></el-option>
					      	<el-option label="系统二" value="XT2"></el-option>
					    </el-select>
	  				</el-form-item>
	  				<el-form-item>
	  					<el-button type="primary" @click="onQuery">查询</el-button>
  					</el-form-item>
				</el-form>
 			</el-col></el-row>
 			
 			<el-table :data="tableData" border stripe highlight-current-row @row-dblclick="onTableDbl" style="width: 100%">
			    <el-table-column prop="systemName" label="应用系统"></el-table-column>
			    <el-table-column prop="dataType" label="数据类型"></el-table-column>
			    <el-table-column prop="tableNameZw" label="中文名称"></el-table-column>
			    <el-table-column prop="tableName" label="英文名称"></el-table-column>
			    <el-table-column prop="department" label="专业（部门）"></el-table-column>
			    <el-table-column prop="datasourceDesc" label="描述"></el-table-column>
			    <el-table-column prop="cz" label="操作"></el-table-column>
			</el-table>
		</el-main>
	</el-container>
</div>
</body>
<script src="./js/vue.js"></script>
<script src="./js/element.js"></script>
<script src="./js/axios.min.js"></script>
<style>
.el-header, .el-footer {
    background-color: #B3C0D1;
    color: #333;
    text-align: center;
    line-height: 60px;
  }
  
  .el-aside {
    background-color: #D3DCE6;
    color: #333;
    text-align: center;
    line-height: 200px;
  }
  
  .el-main {
    background-color: #E9EEF3;
    color: #333;
    text-align: center;
  }
  
  body > .el-container {
    margin-bottom: 40px;
  }
  
  .el-container:nth-child(5) .el-aside,
  .el-container:nth-child(6) .el-aside {
    line-height: 260px;
  }
  
  .el-container:nth-child(7) .el-aside {
    line-height: 320px;
  }
  
  .widthFull {
  	width: 100%
  }
  
  
 
</style>

<script >
var url = '/datasource';
// 数据表表单
var form = {
	tableName: '',
  	systemName: '',
  	tableNameZw: '',
	dataType: '',
	datasourceDesc: '',
	columns: [
 	 	{
  			key: '',
  			name: '',
  			nameZw: '',
  			comment: '',
  			type: '',
  			isNull: "1",
  		
  		}
  	]
}
// 表单校验 
var rules = {
	systemName: [{ required: true, message: '请选择应用系统', trigger: 'change' }],
	tableName: [{ required: true, message: '请输入表名', trigger: 'change' }],
	tableNameZw: [{ required: true, message: '请输入中文表名', trigger: 'change' }],
	dataType: [{ required: true, message: '请选择数据类型', trigger: 'change' }],
	
}
// 查询表单
var queryForm = {
		systemName: '',
		tableName: ''
}
// 数据表格
var tableData = []

var ex = new Vue({
    el: '#app',
    data: {
    	form: form,
    	queryForm: queryForm,
    	tableData: tableData,
    	loading: false,
    	rules: rules
    },
    methods: {
    	onSubmit: function() {
    		this.$refs['form'].validate((valid) => {
    	          if (valid) {
    	        	  axios.post(url, form)
    	      		.then(function(response){
    	      			console.log(response);
    	      		})
    	      		.catch(function(error){
    	      			console.log(response);
    	      		})
    	          } else {
    	            console.log('error submit!!');
    	            return false;
    	          }
    	    });
    	},
    	onQuery: function() {
    		axios.get(url, queryForm)
    		.then(function(response) {
    			ex.tableData = response.data
    		})
    		.catch(function(error){
    			console.log(error);
    		})
    	},
    	submitForm(formName) {
            this.$refs[formName].validate((valid) => {
              if (valid) {
                alert('submit!');
              } else {
                console.log('error submit!!');
                return false;
              }
            });
          },
          resetForm(formName) {
            this.$refs[formName].resetFields();
          },
          removeColumn(item) {
            var index = this.form.columns.indexOf(item)
            if (index !== -1 && this.form.columns.length !== 1) {
              this.form.columns.splice(index, 1)
            }
          },
          addColumn(item) {
        	  var index = this.form.columns.indexOf(item)
        	  this.form.columns.splice(index + 1, 0, {
                  key: Date.now(),
                  name: '',
                  nameZw: '',
                  comment: '',
                  type: '',
                  isNull: "1",
        	  })
          },
          onTableDbl: function(row, column, event) {
        	  if (!row.columns) {
        		  row.columns = [
        		 	 	{
        		  			key: '',
        		  			name: '',
        		  			nameZw: '',
        		  			comment: '',
        		  			type: '',
        		  			isNull: "1",
        		  		
        		  		}
        		  	]
        	  }
        	  ex.form = row
          }
    }
})
</script>
</html>